---
title: "[nullabor](http://dicook.github.io/nullabor/)"
subtitle: "tools for testing whether what you see in plots is really there"
author: "<br>Di Cook, Monash University"
date: "<br>NYC R meetup - June 6, 2019 <br> [Slides here](http://dicook.org/NYCR/slides.html)"
output:
  xaringan::moon_reader:
    css: ["mystyle.css", shinobi, ninjutsu]
    lib_dir: libs
    nature:
      ratio: '16:9'
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(tidy = FALSE, 
                      message = FALSE,
                      warning = FALSE,
                      echo = FALSE, 
                      fig.retina = 2)
options(htmltools.dir.version = FALSE)
```

```{r}
library(tidyverse)
library(lubridate)
library(tsibble)
library(forcats)
library(nullabor)
library(forecast)
library(ochRe)
```

class: center, middle

# Why?

---
background-image: url("http://dicook.org/files/NYCR/images/polls1.png")
background-position: 50% 50%
background-size: cover

---
background-image: url("http://dicook.org/files/NYCR/images/polls1.png")
background-position: 50% 50%
background-size: cover

---
background-image: url("http://dicook.github.io/nullabor/articles/nullabor_files/figure-html/unnamed-chunk-8-1.png")
background-position: 50% 50%
background-size: cover

---
class: center, middle

```{r eval=FALSE}
nyc <- read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2018/2018-12-11/nyc_restaurants.csv")
nyc_clean <- nyc %>% mutate(inspection_date = mdy(inspection_date)) %>%
  filter(year(inspection_date) > 2014) %>%
  filter(!is.na(grade)) %>%
  filter(grade %in% c("A", "B", "C")) %>%
  mutate(yrmth = yearmonth(inspection_date)) 
save(nyc_clean, file="data/nyc_clean.rda")
```

```{r out.width="100%", fig.width=12}
load("data/nyc_clean.rda")
nyc_yrmth <- nyc_clean %>%
  count(yrmth, grade) %>% 
  group_by(yrmth) %>%
  mutate(pct = n/sum(n)*100) 
#ggplot(nyc_yrmth, aes(x=yrmth, y=pct, colour=grade)) + 
#  geom_line() + xlab("") + ylab("% receiving grade") +
#  scale_color_ochre(palette="parliament") 
nyc_yrmth_l <- lineup(null_ts("pct", auto.arima), filter(nyc_yrmth, grade=="A"))
ggplot(nyc_yrmth_l, aes(x=yrmth, y=pct)) + 
  geom_line() + xlab("") + ylab("% A grade") +
  facet_wrap(~.sample)
```
---

```{r out.width="100%", fig.width=12}
nyc_clean <- nyc_clean %>%
  mutate(rats = grepl("rats", violation_description), 
         mice = grepl("mice", violation_description), 
         roaches = grepl("roach", violation_description)) %>%
  #mutate(vermin = as.factor(as.numeric(rats)+as.numeric(mice)+as.numeric(roaches))) %>%
  mutate(vermin = "none") %>%
  mutate(vermin = ifelse(roaches, "cockroaches", vermin)) %>%
  mutate(vermin = ifelse(rats, "rats", vermin)) %>%
  mutate(vermin = ifelse(mice, "mice", vermin)) %>%
  mutate(vermin = factor(vermin, levels=c("none", "mice", "rats", "cockroaches")))
#ggplot(nyc_clean, aes(x=vermin, fill=grade)) + 
#  geom_bar(position="fill") +
#  scale_fill_ochre(palette="parliament") + xlab("") + ylab("") +
#  coord_flip() + theme_bw() 

ggplot(lineup(null_permute("grade"), nyc_clean), aes(x=grade, fill=vermin)) +
  geom_bar(position="fill") +
  scale_fill_ochre(palette="parliament") + xlab("") + ylab("") +
  facet_wrap(~ .sample) +
  coord_flip() + theme_bw() + theme(legend.position="none")
```


---

# Summary

- Really useful package
- Helps to adjust our expectations, dampen surprise, support surprise
- Calibrate your eyes on what randomness looks like

Original version of the package written by Hadley Wickham, $p$-value and power functions by Heike Hofmann, metrics and model nulls by Niladri Roy Chowdhury, and time series nulls and code updates by myself and Stuart Lee.

Website for package is [http://dicook.github.io/nullabor/articles/nullabor.html](http://dicook.github.io/nullabor/articles/nullabor.html).

---
# Acknowledgements

# `r set.seed(2019); emo::ji("technologist")` Made by a human with a computer

Slides at [https://dicook.org/](https://dicook.org/files/NYCR/slides.html).
Code and data at [https://github.com/dicook/NYCR](https://github.com/dicook/NYCR).
<br>

Created using [R Markdown](https://rmarkdown.rstudio.com) with flair by [**xaringan**](https://github.com/yihui/xaringan), and Australianised **shinobu** style.

<br> 
<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.


